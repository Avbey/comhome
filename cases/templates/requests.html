{% extends 'base.html' %}
{% load staticfiles %}
{% load paginate %}
{% block title %} <title>Заявки - Comfortable Home</title>{% endblock %}
{% block breadcrumb %}
<div class="page-header">
    <h2 class="pageheader-title">Заявки</h2>
</div>
{% endblock %}
{% block content %}
<div class="main_container">

  <!-- filter_row starts here -->
  <div class="filter_row row marl">
{#    <div class="col-md-12">#}
{#      <div class="card">#}
{#        <form id="cases_filter" method="POST" action="" >#}
{#          <div class="card-body">#}
{#            <div class="card-title">Фильтры</div>#}
{#            <div class="row marl">#}
{#            <div class="filter_col col-md-3">#}
{#                <div class="form-group">#}
{#                  <label for="exampleInputEmail1">Тип проблемы</label>#}
{#                  <select class="form-control" id="id_status" name="status" >#}
{#                    <option value="">--Тип проблемы--</option>#}
{#                    {% for each_type in request_type %}#}
{#                    <option value="{{each_type.0}}" {% if request.POST.type %} {% ifequal each_type.0 request.POST.type %}selected{% endifequal %}{% endif %} >{{each_type.1}} </option>#}
{#                    {% endfor%}#}
{#                  </select>#}
{#                </div>#}
{#              </div>#}
{#              <div class="filter_col col-md-3">#}
{#                <div class="form-group">#}
{#                  <label for="exampleInputEmail1">Статус</label>#}
{#                  <select class="form-control" id="id_status" name="status" >#}
{#                    <option value="">--Статус--</option>#}
{#                    {% for each_status in request_status %}#}
{#                    <option value="{{each_status.0}}" {% if request.POST.status %} {% ifequal each_status.0 request.POST.status %}selected{% endifequal %}{% endif %} >{{each_status.1}} </option>#}
{#                    {% endfor%}#}
{#                  </select>#}
{#                </div>#}
{#              </div>#}
{#              <div class="filter_col col-md-3">#}
{#                <div class="form-group">#}
{#                  <label for="exampleInputEmail1">Приоритет</label>#}
{#                  <select class="form-control" id="id_priority" name="priority" >#}
{#                    <option value="">--Приоритет--</option>#}
{#                    {% for each_priority in request_priority %}#}
{#                    <option value="{{each_priority.0}}" {% if request.POST.priority %} {% ifequal each_priority.0 request.POST.priority %}selected{% endifequal %}{% endif %}>{{each_priority.1}} </option>#}
{#                    {% endfor%}#}
{#                  </select>#}
{#                </div>#}
{#              </div>#}
{#              <div class="filter_col col-md-3">#}
{#                <div class="form-group">#}
{#                  <label for="exampleInputEmail1">Исполнитель</label>#}
{#                  <select class="form-control" id="id_account" name="account">#}
{#                    <option value="">--Выберите исполнителя--</option>#}
{#                    {% for ac in staff %}#}
{#                    <option value="{{ac.id}}" {% ifequal acc ac.id %} selected {% endifequal %} >{{ac.name}}</option>#}
{#                    {% endfor %}#}
{#                  </select>#}
{#                  </select>#}
{#                </div>#}
{#              </div>#}
{#              <input type="hidden" id="per_page_field" name="per_page">#}
{#              <div class="filter_col text-center col-12">#}
{#                <div class="form-group buttons_row text-center">#}
{#                  <button class="btn btn-primary save" id="filter_click" type="submit">Поиск</button>#}
{#                  <a href="{% url 'cases:list' %}" id="filter_clear" class="btn btn-default clear">Сброс</a>#}
{#                </div>#}
{#              </div>#}
{#            </div>#}
{#          </div>#}
{#        </form>#}
{#        <br clear="all">#}
{#      </div>#}
{#    </div>#}
    <div class="col-md-12">
       <!-- cases_list starts here -->
  <div class="table_container_row row marl no-gutters">
    <div class="col-md-12">
      <div class="card">
        
        <div class="card-body">
        <div class="panel-heading-list card-title">
          <span class="float-right total_count">{% if show_pageitems %} {% show_pageitems %}{% else %}Всего: {{ requests|length }}{% endif %}</span>
        </div>
        <div class="table-responsive">
          <table class="table table-striped table-bordered first" id="multiselect">
            <thead>
              {% if requests|length > 0 %}
                <tr>
                  <th>Отправитель</th>
                  <th>Тематика</th>
                  <th>Исполнители</th>
                  <th>Статус</th>
                  <th>Приоритет</th>
                  <th>Действия</th>
                </tr>
              {% endif %}
            </thead>
            <tbody>
              {% if per_page %}
                {% paginate per_page requests %}
              {% else%}
                {% paginate 10 requests%}
              {% endif %}
              {% for case in requests %}
              <tr class="case_row{{case.id}}">
                <td scope="row">{{ case.created_by }}</td>
                <td><a href="{% url 'cases:view_request' case.id %}">{{case.request_type}}</a></td>
                <td>
                {% if case.assigned_to.count > 1 %}
                    {% for assigned_to in case.assigned_to.all %}
                        <a href="{% url 'accounts:view_account' assigned_to.id %}" title="Подробнее">{{ assigned_to.name }}</a>{% if not forloop.last %},<br>{% endif %}
                    {% endfor %}
                {% elif case.assigned_to.count == 1 %}
                    <a href="{% url 'accounts:view_account' case.assigned_to.first.id %}" title="Подробнее">{{ case.assigned_to.first.name }}</a>
                {% else%}
                    Не указаны
                {% endif %}
                </td>
                <td id="status_id{{case.id}}" status="{{case.status}}">{{ case.status }}</td>
                <td>{{ case.priority }}</td>
                <td class="actions">
                    <a href="{% url 'cases:view_request' case.id %}" title="Подробнее"><i class="fas fa-eye"></i></a>
                    <a href="{% url 'cases:edit_request' case.id %}" title="Редактировать"><i class="fas fa-pencil-alt"></i></a>
                    <a href="{% url 'cases:remove_request' case.id %}" title="Удалить"><i class="fas fa-trash-alt"></i></a>
                  {% if case.status != 'Closed' %}
{#                  <a onclick="close_case({{case.id}}, '{% url 'cases:close_case' %}')" class="btn btn-warning"><i class="fas fa-times"></i> </a>#}
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          </div>
          {% ifequal requests|length 0 %}
            <h6 class="text-center">Ничего не найдено</h6>
          {% endifequal %}
          <div class="marl row text-center">
            {% show_pages %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- cases_list ends here -->
    </div>

  </div>
  <!-- filter_row ends here -->
 
</div>
<!-- main_container ends here -->
{% endblock %}
{% block js_block %}
{% endblock js_block %}
